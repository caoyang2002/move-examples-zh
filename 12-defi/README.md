# 概述

锁定合约，允许赞助商（sponsor）将特定代币（CoinType）锁定一段时间后发送给特定接收者（recipient）。

* 这提供了一个示例，用于将锁定的硬币发送给接收者，在特定时间后解锁。
* 锁定硬币流程：
   1. 部署锁定合约。部署者可以决定合约是否可升级。
   2. 赞助账户（赞助者）调用 `initialize_sponsor`，使用适当的 `CoinType` 来设置他们的账户，以便稍后创建锁定。
   3. 赞助者为接收者增加具有自定义到期时间 + 金额的锁定 APT。每个锁定被称为一个“锁”。
   4. 赞助者可以随时撤销一个锁或更改锁定（减少或延长）。这在合同违约或特殊情况下提供了灵活性。如果不需要此功能，部署者可以在部署之前移除这些功能。如果锁被取消，锁定的硬币将被退回至提款地址。这个提款地址在初始化赞助账户时设置，并且只有在没有活跃或未认领的锁时才能更改。
   5. 锁定到期后，接收者可以调用 `claim` 来获取解锁的 Token。

# 快速开始

## 使用私钥创建账户

```bash
aptos init --network testnet --private-key 0xyour...private...key
```

## 测试

```bash
aptos move test
```

# 详解

1. **数据结构定义**：
   - `Lock<CoinType>`：代表一个锁定的代币，包括代币数量和解锁时间。
   - `Locks<CoinType>`：包含一个映射表，将接收者地址映射到锁定的代币。同时，还记录了撤回地址和未解锁的锁的数量。

2. **事件定义**：
   - `CancelLockup`：当取消锁定时发出，记录了赞助商、接收者和取消的代币数量。
   - `Claim`：当接收者成功解锁代币时发出，记录了赞助商、接收者、解锁的代币数量和时间。
   - `UpdateLockup`：当更新锁定时发出，记录了赞助商、接收者、旧的解锁时间和新的解锁时间。
   - `UpdateWithdrawalAddress`：当更新撤回地址时发出，记录了赞助商、旧的撤回地址和新的撤回地址。

3. **错误码定义**：
   - `ELOCK_NOT_FOUND`：未找到要求的锁定。
   - `ELOCKUP_HAS_NOT_EXPIRED`：锁定尚未到期，无法解锁。
   - `ELOCK_ALREADY_EXISTS`：每个接收者只能有一个活跃的锁定。
   - `EINVALID_RECIPIENTS_LIST_LENGTH`：接收者列表的长度与代币数量列表的长度不匹配。
   - `ESPONSOR_ACCOUNT_NOT_INITIALIZED`：赞助商账户未初始化，无法创建锁定。
   - `EACTIVE_LOCKS_EXIST`：存在未解锁的锁定，无法更新撤回地址。

4. **函数定义**：
   - `initialize_sponsor`：初始化赞助商账户，设置撤回地址。
   - `update_withdrawal_address`：更新撤回地址，前提是不存在未解锁的锁定。
   - `add_locked_coins`：赞助商添加锁定代币给接收者。
   - `claim`：接收者解锁代币，将解锁的代币数量转入其账户。
   - `update_lockup`：更新现有锁定的解锁时间。
   - `cancel_lockup`：取消现有的锁定，并将代币返回到撤回地址。

5. **测试用例**：
   - 提供了多个测试用例，验证了锁定代币、更新锁定、取消锁定和解锁代币的各种情况。这些测试用例使用了特殊的测试框架和伪造的签名者地址来模拟不同的场景，确保合约在各种条件下的正确性。
